version: '3.8'

services:
  # 3 Validator Nodes (Quick Setup)
  validator-1:
    build:
      context: .
      dockerfile: Dockerfile.validator
    container_name: av10-validator-1
    ports:
      - "8181:8181"
    environment:
      - NODE_ID=validator-1
      - NODE_TYPE=validator
      - VALIDATOR_ID=1
      - CONSENSUS_PORT=8181
      - PEER_DISCOVERY_PORT=9181
      - QUANTUM_LEVEL=5
      - TARGET_TPS=300000
    networks:
      - aurigraph-network
    restart: unless-stopped

  validator-2:
    build:
      context: .
      dockerfile: Dockerfile.validator
    container_name: av10-validator-2
    ports:
      - "8182:8181"
    environment:
      - NODE_ID=validator-2
      - NODE_TYPE=validator
      - VALIDATOR_ID=2
      - CONSENSUS_PORT=8181
      - PEER_DISCOVERY_PORT=9182
      - QUANTUM_LEVEL=5
      - TARGET_TPS=300000
    networks:
      - aurigraph-network
    restart: unless-stopped

  validator-3:
    build:
      context: .
      dockerfile: Dockerfile.validator
    container_name: av10-validator-3
    ports:
      - "8183:8181"
    environment:
      - NODE_ID=validator-3
      - NODE_TYPE=validator
      - VALIDATOR_ID=3
      - CONSENSUS_PORT=8181
      - PEER_DISCOVERY_PORT=9183
      - QUANTUM_LEVEL=5
      - TARGET_TPS=300000
    networks:
      - aurigraph-network
    restart: unless-stopped

  # 5 Basic Nodes (Quick Setup)
  basic-node-1:
    build:
      context: .
      dockerfile: Dockerfile.basicnode
    container_name: av10-basic-1
    ports:
      - "8201:8201"
    environment:
      - NODE_ID=basic-1
      - NODE_TYPE=basic
      - API_PORT=8201
      - PEER_DISCOVERY_PORT=9201
      - QUANTUM_LEVEL=3
    networks:
      - aurigraph-network
    restart: unless-stopped

  basic-node-2:
    build:
      context: .
      dockerfile: Dockerfile.basicnode
    container_name: av10-basic-2
    ports:
      - "8202:8201"
    environment:
      - NODE_ID=basic-2
      - NODE_TYPE=basic
      - API_PORT=8201
      - PEER_DISCOVERY_PORT=9202
      - QUANTUM_LEVEL=3
    networks:
      - aurigraph-network
    restart: unless-stopped

  basic-node-3:
    build:
      context: .
      dockerfile: Dockerfile.basicnode
    container_name: av10-basic-3
    ports:
      - "8203:8201"
    environment:
      - NODE_ID=basic-3
      - NODE_TYPE=basic
      - API_PORT=8201
      - PEER_DISCOVERY_PORT=9203
      - QUANTUM_LEVEL=3
    networks:
      - aurigraph-network
    restart: unless-stopped

  basic-node-4:
    build:
      context: .
      dockerfile: Dockerfile.basicnode
    container_name: av10-basic-4
    ports:
      - "8204:8201"
    environment:
      - NODE_ID=basic-4
      - NODE_TYPE=basic
      - API_PORT=8201
      - PEER_DISCOVERY_PORT=9204
      - QUANTUM_LEVEL=3
    networks:
      - aurigraph-network
    restart: unless-stopped

  basic-node-5:
    build:
      context: .
      dockerfile: Dockerfile.basicnode
    container_name: av10-basic-5
    ports:
      - "8205:8201"
    environment:
      - NODE_ID=basic-5
      - NODE_TYPE=basic
      - API_PORT=8201
      - PEER_DISCOVERY_PORT=9205
      - QUANTUM_LEVEL=3
    networks:
      - aurigraph-network
    restart: unless-stopped

  # Management Console
  management-console:
    build:
      context: ./fastapi-aurigraph
      dockerfile: Dockerfile.minimal
    container_name: av10-management-console
    ports:
      - "3040:3100"
    environment:
      - PLATFORM_NAME=Aurigraph Management Console
      - NODE_MANAGEMENT_MODE=true
      - VALIDATOR_COUNT=3
      - BASIC_NODE_COUNT=5
      - MANAGEMENT_PORT=3100
    volumes:
      - ./ui:/app/static:ro
    networks:
      - aurigraph-network
    restart: unless-stopped
    depends_on:
      - validator-1
      - validator-2
      - basic-node-1

  # Monitoring Dashboard
  monitoring-dashboard:
    image: nginx:alpine
    container_name: av10-monitoring
    ports:
      - "3052:80"
    volumes:
      - ./ui:/usr/share/nginx/html:ro
    environment:
      - NGINX_HOST=localhost
      - NGINX_PORT=80
    networks:
      - aurigraph-network
    restart: unless-stopped

networks:
  aurigraph-network:
    driver: bridge