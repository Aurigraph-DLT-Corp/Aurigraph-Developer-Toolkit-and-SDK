################################################################################
# docker-compose-simple.yml
# Simple local deployment demo - V11 placeholder and monitoring
################################################################################

version: '3.9'

services:
  # V11 Placeholder - Development Progress Showcase
  aurigraph-v11-placeholder:
    image: nginx:alpine
    container_name: aurigraph-v11-demo
    hostname: aurigraph-v11
    ports:
      - "9003:80"  # V11 port
    volumes:
      - ./v11-placeholder.html:/usr/share/nginx/html/index.html:ro
    environment:
      NGINX_HOST: localhost
      NGINX_PORT: 80
    networks:
      - aurigraph-demo
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost/"]
      interval: 10s
      timeout: 3s
      retries: 3
      start_period: 5s

  # Use existing V10 image
  aurigraph-v10:
    image: aurigraph-av10-7-validator-01:latest
    container_name: aurigraph-v10-demo
    hostname: aurigraph-v10
    ports:
      - "8180:8080"  # V10 main port
      - "3141:3040"  # V10 management
    environment:
      NODE_ENV: production
      TARGET_TPS: 1000000
      LOG_LEVEL: info
    networks:
      - aurigraph-demo
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Simple Load Balancer
  load-balancer:
    image: nginx:alpine
    container_name: aurigraph-lb
    ports:
      - "8002:80"  # Load balanced access
    volumes:
      - ./nginx-lb.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - aurigraph-v10
      - aurigraph-v11-placeholder
    networks:
      - aurigraph-demo
    restart: unless-stopped

  # Monitoring Dashboard
  monitoring:
    image: nginx:alpine
    container_name: aurigraph-monitoring
    ports:
      - "3100:80"
    volumes:
      - ./monitoring-dashboard.html:/usr/share/nginx/html/index.html:ro
    networks:
      - aurigraph-demo
    restart: unless-stopped

networks:
  aurigraph-demo:
    driver: bridge
    ipam:
      config:
        - subnet: 172.25.0.0/16