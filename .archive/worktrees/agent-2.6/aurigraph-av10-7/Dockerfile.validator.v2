FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY tsconfig.json ./

# Install all dependencies including dev dependencies for ts-node
RUN npm install

# Copy source code and scripts
COPY src/ ./src/
COPY scripts/ ./scripts/
COPY config/ ./config/

# Install global dependencies
RUN npm install -g typescript ts-node

EXPOSE 8081 30001

CMD ["npx", "ts-node", "scripts/docker-validator-start.ts"]