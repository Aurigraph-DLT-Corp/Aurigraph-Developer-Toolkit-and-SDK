# Kustomization for Production Multi-Region Deployment
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: aurigraph-system

# Base configuration
bases:
  - ../../helm/aurigraph-v11

# Production-specific resources
resources:
  - namespace.yaml
  - priority-class.yaml
  - network-policies.yaml
  - service-accounts.yaml
  - rbac.yaml
  - secrets.yaml
  - multi-region-setup.yaml
  - disaster-recovery.yaml
  - backup-schedule.yaml
  - monitoring-stack.yaml

# Production patches
patchesStrategicMerge:
  - production-patches.yaml
  - security-hardening.yaml
  - performance-optimization.yaml
  - resource-limits.yaml

# Images with production tags
images:
  - name: aurigraph/v11-native
    newTag: 11.0.0-prod
  - name: prometheus/prometheus
    newTag: v2.45.0
  - name: grafana/grafana
    newTag: 10.0.0
  - name: jaegertracing/all-in-one
    newTag: 1.47
  - name: redis
    newTag: 7.2-alpine
  - name: postgres
    newTag: 15.3-alpine

# Configuration generators
configMapGenerator:
  - name: aurigraph-v11-production-config
    literals:
      - ENVIRONMENT=production
      - TARGET_TPS=2500000
      - CONSENSUS_CLUSTER_SIZE=15
      - AI_OPTIMIZATION_ENABLED=true
      - NATIVE_MODE=true
      - MULTI_REGION=true
      - DISASTER_RECOVERY_ENABLED=true
      - CROSS_REGION_REPLICATION=true
      - TLS_VERSION=1.3
      - QUANTUM_LEVEL=5
      - LOG_LEVEL=INFO
      - METRICS_ENABLED=true
      - TRACING_ENABLED=true
      - PROMETHEUS_SCRAPE_INTERVAL=15s
      - GRAFANA_DASHBOARD_REFRESH=5s

# Secret generators (placeholder - use external secret management in production)
secretGenerator:
  - name: aurigraph-v11-production-secrets
    literals:
      - DATABASE_PASSWORD=CHANGEME
      - REDIS_PASSWORD=CHANGEME
      - JWT_SECRET=CHANGEME
      - ENCRYPTION_KEY=CHANGEME
      - GRAFANA_ADMIN_PASSWORD=CHANGEME
    type: Opaque

# Labels to apply to all resources
commonLabels:
  app: aurigraph-v11
  environment: production
  tier: platform
  version: "11.0.0"
  managed-by: kustomize

# Annotations to apply to all resources
commonAnnotations:
  deployment.kubernetes.io/revision: "1"
  aurigraph.io/environment: production
  aurigraph.io/region: multi-region
  aurigraph.io/disaster-recovery: enabled

# Replica count transformations
replicas:
  - name: aurigraph-v11-production
    count: 15  # 5 pods per region across 3 regions
  - name: aurigraph-v11-consensus
    count: 15  # Consensus nodes across regions
  - name: aurigraph-v11-prometheus
    count: 3   # One per region
  - name: aurigraph-v11-grafana
    count: 3   # One per region

# Variable substitution
vars:
  - name: PRODUCTION_NAMESPACE
    objref:
      kind: Namespace
      name: aurigraph-system
      apiVersion: v1
    fieldref:
      fieldpath: metadata.name
  - name: CLUSTER_NAME
    objref:
      kind: ConfigMap
      name: cluster-info
      apiVersion: v1
    fieldref:
      fieldpath: data.cluster-name