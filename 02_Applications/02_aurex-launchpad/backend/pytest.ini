# ================================================================================
# AUREX LAUNCHPADâ„¢ PYTEST CONFIGURATION
# Comprehensive testing configuration for backend API testing
# Ticket: LAUNCHPAD-401 - Testing & Validation Suite (21 story points)
# Created: August 7, 2025
# ================================================================================

[tool:pytest]
# Test discovery patterns
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output configuration
addopts = 
    -v
    --strict-markers
    --strict-config
    --tb=short
    --cov=.
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-report=xml:coverage.xml
    --cov-fail-under=85
    --cov-config=.coveragerc
    --durations=10
    --maxfail=5

# Test markers for categorization
markers =
    # Authentication and security tests
    auth: Authentication and authorization tests
    security: Security-related tests
    auth_api: Authentication API endpoint tests
    
    # Database and model tests  
    database: Database operation tests
    models: SQLAlchemy model tests
    integration: Database integration tests
    
    # API endpoint tests
    api: API endpoint tests
    assessments: Assessment API tests
    analytics: Analytics API tests
    projects: Project management API tests
    emissions: GHG emissions API tests
    
    # Performance and load tests
    performance: Performance benchmarking tests
    load: Load testing scenarios
    stress: Stress testing scenarios
    
    # Integration and E2E tests
    e2e: End-to-end workflow tests
    workflow: Complete user workflow tests
    
    # Test categories by speed
    unit: Fast unit tests (<100ms)
    slow: Slower tests (>1s)
    
    # Test environment markers
    ci: Tests suitable for CI environment
    local: Tests requiring local environment
    
    # Feature-specific markers
    vibe: VIBE framework tests
    esg: ESG assessment tests
    reporting: Report generation tests
    
    # Data quality and validation
    validation: Input validation tests
    constraints: Database constraint tests

# Minimum Python version
minversion = 3.8

# Warning filters
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # Ignore specific SQLAlchemy warnings in test environment
    ignore:.*:sqlalchemy.exc.SAWarning
    # Ignore asyncio warnings in test environment  
    ignore:.*:DeprecationWarning:asyncio

# Test collection configuration
collect_ignore = [
    "venv",
    "node_modules",
    ".git",
    "__pycache__",
    "htmlcov",
    "migrations",
    ".pytest_cache"
]

# Logging configuration for tests
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d - %(funcName)s(): %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Timeout configuration
timeout = 300
timeout_method = thread

# Parallel test execution (when pytest-xdist is installed)
# addopts += -n auto

# Test ordering (when pytest-ordering is installed)  
# addopts += --order-dependencies

# Pytest plugins
required_plugins = 
    pytest-cov>=4.0.0
    pytest-asyncio>=0.21.0
    pytest-mock>=3.10.0
    pytest-timeout>=2.1.0

# Environment variables for testing
env = 
    TESTING = true
    DATABASE_URL = sqlite:///:memory:
    JWT_SECRET_KEY = test_secret_key_for_testing_only
    JWT_ALGORITHM = HS256
    JWT_ACCESS_TOKEN_EXPIRE_MINUTES = 30
    JWT_REFRESH_TOKEN_EXPIRE_DAYS = 7
    ENVIRONMENT = testing
    LOG_LEVEL = INFO
    DISABLE_AUTH = false
    REDIS_URL = redis://localhost:6379/1

# Async test configuration  
asyncio_mode = auto

# Coverage configuration (additional to .coveragerc)
# --cov-context=test for per-test coverage tracking