# Aurigraph V11 Helm Values Configuration
# Production-ready configuration for high-performance blockchain platform

global:
  imageRegistry: "aurigraph"
  imagePullSecrets: []
  storageClass: "fast-ssd"
  
# Application Configuration
app:
  name: aurigraph-v11
  version: "11.0.0"
  environment: "production"

# Container Images
images:
  platformService:
    repository: "aurigraph/platform-service"
    tag: "v11.0.0-native"
    pullPolicy: "Always"
  consensusService:
    repository: "aurigraph/consensus-service"
    tag: "v11.0.0-native"
    pullPolicy: "Always"
  cryptoService:
    repository: "aurigraph/crypto-service"
    tag: "v11.0.0-native"
    pullPolicy: "Always"
  networkService:
    repository: "aurigraph/network-service"
    tag: "v11.0.0-native"
    pullPolicy: "Always"
  crosschainBridge:
    repository: "aurigraph/crosschain-bridge"
    tag: "v11.0.0-native"
    pullPolicy: "Always"
  aiOptimization:
    repository: "aurigraph/ai-optimization"
    tag: "v11.0.0-native"
    pullPolicy: "Always"

# Replica Configuration
replicas:
  platformService: 3
  consensusService: 5
  cryptoService: 3
  networkService: 4
  crosschainBridge: 2
  aiOptimization: 2

# Auto-scaling Configuration
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 100
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Custom metrics for TPS-based scaling
  customMetrics:
    - type: "Pods"
      pods:
        metric:
          name: "transactions_per_second"
        target:
          type: "AverageValue"
          averageValue: "30000" # 30k TPS per pod, scale at 70% = ~21k TPS

# Resource Configuration
resources:
  platformService:
    requests:
      memory: "2Gi"
      cpu: "1000m"
      ephemeral-storage: "10Gi"
    limits:
      memory: "8Gi"
      cpu: "4000m"
      ephemeral-storage: "50Gi"
  consensusService:
    requests:
      memory: "4Gi"
      cpu: "2000m"
      ephemeral-storage: "20Gi"
    limits:
      memory: "16Gi"
      cpu: "8000m"
      ephemeral-storage: "100Gi"
  cryptoService:
    requests:
      memory: "1Gi"
      cpu: "500m"
      ephemeral-storage: "5Gi"
    limits:
      memory: "4Gi"
      cpu: "2000m"
      ephemeral-storage: "25Gi"
  networkService:
    requests:
      memory: "2Gi"
      cpu: "1000m"
      ephemeral-storage: "10Gi"
    limits:
      memory: "8Gi"
      cpu: "4000m"
      ephemeral-storage: "50Gi"

# Service Configuration
service:
  type: ClusterIP
  ports:
    http: 8080
    grpc: 9090
    p2p: 7000
    metrics: 9464

# Ingress Configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.aurigraph.io
      paths:
        - path: /
          pathType: Prefix
    - host: grpc.aurigraph.io
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: aurigraph-tls
      hosts:
        - api.aurigraph.io
        - grpc.aurigraph.io

# Storage Configuration
persistence:
  enabled: true
  storageClass: "fast-ssd"
  accessMode: ReadWriteOnce
  size: 1000Gi
  # Blockchain data storage
  blockchain:
    size: 500Gi
  # Transaction logs
  logs:
    size: 200Gi
  # AI model storage
  models:
    size: 100Gi
  # Cross-chain state
  crosschain:
    size: 200Gi

# Security Configuration
security:
  # Pod Security Standards
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  
  # Container Security Context
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # Network Policies
  networkPolicy:
    enabled: true
    ingress:
      - from:
        - namespaceSelector:
            matchLabels:
              name: istio-system
        - namespaceSelector:
            matchLabels:
              name: monitoring
    egress:
      - to: []
        ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 80

# Service Mesh (Istio)
istio:
  enabled: true
  injection: enabled
  gateway:
    enabled: true
    hosts:
      - "api.aurigraph.io"
      - "grpc.aurigraph.io"
  virtualService:
    enabled: true
    timeout: "30s"
    retries:
      attempts: 3
      perTryTimeout: "10s"
  destinationRule:
    enabled: true
    trafficPolicy:
      loadBalancer:
        simple: LEAST_CONN
      connectionPool:
        tcp:
          maxConnections: 1000
        http:
          http1MaxPendingRequests: 100
          maxRequestsPerConnection: 10

# Monitoring Configuration
monitoring:
  prometheus:
    enabled: true
    scrapeInterval: "15s"
    path: "/metrics"
    port: 9464
  grafana:
    enabled: true
    dashboards:
      enabled: true
  jaeger:
    enabled: true
    sampling:
      type: "probabilistic"
      param: 0.1

# Configuration Management
config:
  # Blockchain Configuration
  blockchain:
    networkId: "aurigraph-mainnet"
    consensusAlgorithm: "hyperraft"
    blockTime: "1s"
    maxTransactionsPerBlock: 10000
    targetTPS: 3000000
  
  # Performance Configuration
  performance:
    nativeImageEnabled: true
    jvmOptimizations: true
    graalVmOptimizations: true
    asyncProcessing: true
    batchSize: 1000
    threadPoolSize: 200
  
  # Security Configuration
  cryptography:
    algorithm: "post-quantum"
    keySize: 4096
    hashAlgorithm: "SHA3-256"
    signatureScheme: "CRYSTALS-Dilithium"

# Environment-specific Overrides
environments:
  development:
    replicas:
      platformService: 1
      consensusService: 1
      cryptoService: 1
      networkService: 1
    autoscaling:
      maxReplicas: 5
    persistence:
      size: 50Gi
  
  staging:
    replicas:
      platformService: 2
      consensusService: 3
      cryptoService: 2
      networkService: 2
    autoscaling:
      maxReplicas: 20
    persistence:
      size: 200Gi
  
  production:
    # Use default values for production

# Backup and Disaster Recovery
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: "30d"
  storageClass: "backup-storage"
  encryption: true

# Health Checks
health:
  livenessProbe:
    httpGet:
      path: /health/live
      port: 8080
    initialDelaySeconds: 60
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health/ready
      port: 8080
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  startupProbe:
    httpGet:
      path: /health/started
      port: 8080
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 30