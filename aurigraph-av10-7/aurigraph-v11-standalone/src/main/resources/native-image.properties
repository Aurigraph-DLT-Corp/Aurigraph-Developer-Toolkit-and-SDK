# GraalVM Native Image Configuration for Aurigraph V11
# This file contains native image build directives for GraalVM compilation

# =========================================================================
# JDK Modules and Components
# =========================================================================

# ForkJoinPool Configuration - CRITICAL for parallel processing
# These must be initialized at runtime to avoid accessor errors
InitializeAtRunTime=java.util.concurrent.ForkJoinPool
InitializeAtRunTime=java.util.concurrent.ForkJoinPool$Submitter
InitializeAtRunTime=java.util.concurrent.ForkJoinWorkerThread
InitializeAtRunTime=java.util.concurrent.ForkJoinTask
InitializeAtRunTime=java.util.concurrent.ForkJoinWorkerThread$InnocuousForkJoinWorkerThread

# Additional JDK classes that need runtime initialization
InitializeAtRunTime=java.util.concurrent.ThreadLocalRandom
InitializeAtRunTime=jdk.internal.vm.Unsafe

# =========================================================================
# Reflection Configuration
# =========================================================================

# Enable reflection for concurrent classes
EnableAllSecurityServices=true

# =========================================================================
# JIT Compilation Directives
# =========================================================================

# Exclude certain packages from native image to reduce size
# These will still work via JIT in native image runtime
-H:ExcludeClasses=\
  sun.misc.Unsafe,\
  java.util.concurrent.locks.LockSupport

# =========================================================================
# Performance Tuning
# =========================================================================

# Use serial GC for predictable performance in native images
-H:+UseSerialGC

# Enable optimization for startup
-H:+ReportExceptionStackTraces

# =========================================================================
# Memory Configuration
# =========================================================================

# Set maximum image heap size (will be overridden by pom.xml if specified)
-H:NativeImageHeapSize=8g

# =========================================================================
# Logging and Diagnostics
# =========================================================================

# Print relevant native image information during build
-H:+PrintClassInitialization
-H:+PrintFeatures
