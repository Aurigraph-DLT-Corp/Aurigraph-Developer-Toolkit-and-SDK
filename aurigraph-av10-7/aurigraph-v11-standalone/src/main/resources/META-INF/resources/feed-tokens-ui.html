<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurigraph V11 - Asset Token Dashboard</title>
    
    <!-- React and dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom styling -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .token-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .token-card:hover {
            background: rgba(30, 41, 59, 0.6);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }
        .throughput-bar {
            height: 6px;
            border-radius: 9999px;
            background: #1e293b;
            overflow: hidden;
        }
        .throughput-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 1s ease-in-out;
        }
        
        /* Audio Guide Pulse */
        .audio-pulse {
            position: relative;
        }
        .audio-pulse::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            animation: pulse-ring 1.5s infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(1.4); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="tokens-root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // Navbar Component
        function Navbar({ activePage }) {
            return (
                <nav className="navbar glass">
                    <a href="dashboard.html" className="nav-logo">
                        <div className="logo-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M16 8l-4 4-4-4"></path>
                                <path d="M12 12v8"></path>
                            </svg>
                        </div>
                        <span>Aurigraph <span className="text-indigo-400">V11</span></span>
                    </a>
                    <div className="nav-links">
                        <a href="dashboard.html" className={`nav-link ${activePage === 'dashboard' ? 'active' : ''}`}>Monitoring</a>
                        <a href="datafeed-ui.html" className={`nav-link ${activePage === 'datafeeds' ? 'active' : ''}`}>Data Feeds</a>
                        <a href="feed-tokens-ui.html" className={`nav-link ${activePage === 'tokens' ? 'active' : ''}`}>Asset Tokens</a>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="hidden lg:block">
                            <span className="badge badge-success">2.1M TPS Max</span>
                        </div>
                    </div>
                </nav>
            );
        }

        // AI Audio Guide Component
        function AudioGuide({ stats, tokensCount }) {
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [isAutoAnnounce, setIsAutoAnnounce] = useState(false);
            const lastThroughputRef = useRef(0);
            
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    // Cancel any ongoing speech
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1.0;
                    utterance.pitch = 1.1; // Slightly futuristic pitch
                    utterance.onstart = () => setIsSpeaking(true);
                    utterance.onend = () => setIsSpeaking(false);
                    window.speechSynthesis.speak(utterance);
                }
            };

            const toggleGuide = () => {
                if (isSpeaking) {
                    window.speechSynthesis.cancel();
                    setIsSpeaking(false);
                } else {
                    const intro = `Welcome to the Aurigraph V-11 Asset Tokenization Dashboard. 
                                  Currently, the network is managing ${tokensCount} live asset tokens. 
                                  Global market capitalization stands at ${Math.round(stats.totalMarketCap)} dollars. 
                                  The aggregate throughput is currently ${Math.round(stats.totalThroughput)} tokens per second. 
                                  I will notify you of any significant network activity.`;
                    speak(intro);
                    setIsAutoAnnounce(true);
                }
            };

            // Auto announcements
            useEffect(() => {
                if (isAutoAnnounce && !isSpeaking && stats.totalThroughput > 0) {
                    const diff = stats.totalThroughput - lastThroughputRef.current;
                    if (Math.abs(diff) > stats.totalThroughput * 0.1) { // 10% change
                        const text = `Network alert: Global throughput has ${diff > 0 ? 'increased' : 'decreased'} to ${Math.round(stats.totalThroughput)} tokens per second.`;
                        speak(text);
                        lastThroughputRef.current = stats.totalThroughput;
                    }
                }
            }, [stats.totalThroughput, isAutoAnnounce, isSpeaking]);

            return (
                <button 
                    onClick={toggleGuide}
                    className={`fixed bottom-8 right-8 z-[100] w-14 h-14 rounded-full glass border-2 ${isAutoAnnounce ? 'border-indigo-500 audio-pulse' : 'border-slate-700'} flex items-center justify-center transition-all hover:scale-110 shadow-2xl`}
                    title={isAutoAnnounce ? "Deactivate AI Voice Guide" : "Activate AI Voice Guide"}
                >
                    {isSpeaking ? (
                        <div className="flex gap-1">
                            <div className="w-1 h-4 bg-indigo-400 animate-[bounce_1s_infinite]"></div>
                            <div className="w-1 h-6 bg-indigo-400 animate-[bounce_0.8s_infinite]"></div>
                            <div className="w-1 h-3 bg-indigo-400 animate-[bounce_1.2s_infinite]"></div>
                        </div>
                    ) : (
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={isAutoAnnounce ? "#818cf8" : "white"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    )}
                </button>
            );
        }

        function FeedTokensDashboard() {
            const [tokens, setTokens] = useState([]);
            const [stats, setStats] = useState({
                totalSupply: 0,
                totalCirculating: 0,
                totalThroughput: 0,
                totalMarketCap: 0
            });
            const [loading, setLoading] = useState(true);

            const fetchData = useCallback(async () => {
                try {
                    const [tokensRes, statsRes] = await Promise.all([
                        fetch('/api/v11/feed-tokens?sortBy=throughput'),
                        fetch('/api/v11/feed-tokens/stats')
                    ]);
                    
                    if (tokensRes.ok && statsRes.ok) {
                        const tokensData = await tokensRes.json();
                        const statsData = await statsRes.json();
                        setTokens(tokensData.tokens || []);
                        setStats(statsData);
                    }
                } catch (err) {
                    console.error('Error fetching tokens:', err);
                } finally {
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 5000);
                return () => clearInterval(interval);
            }, [fetchData]);

            const formatNumber = (num) => {
                if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;
                if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;
                return num.toLocaleString();
            };

            return (
                <div className="min-h-screen">
                    <Navbar activePage="tokens" />
                    
                    <AudioGuide stats={stats} tokensCount={tokens.length} />
                    
                    <main className="content-wrapper">
                        {/* Header Section */}
                        <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10 animate-fade-in">
                            <div>
                                <h1 className="text-3xl font-bold tracking-tight mb-2">Tokenized Feed Assets</h1>
                                <div className="flex items-center gap-3">
                                    <p className="text-slate-400">
                                        Real-time throughput tracking and automatic tokenization of Aurigraph data streams.
                                    </p>
                                    <div className="hidden sm:block h-4 w-px bg-slate-800"></div>
                                    <span className="text-[10px] bg-slate-800 text-indigo-400 px-2 py-1 rounded font-bold tracking-widest uppercase">Layer 1 Parallel</span>
                                </div>
                            </div>
                            <div className="glass px-6 py-4 flex items-center gap-6">
                                <div>
                                    <p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Global Market Cap</p>
                                    <p className="text-2xl font-bold text-indigo-400">${formatNumber(stats.totalMarketCap)}</p>
                                </div>
                                <div className="h-10 w-px bg-slate-800"></div>
                                <div>
                                    <p className="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Active Assets</p>
                                    <p className="text-2xl font-bold">{tokens.length}</p>
                                </div>
                            </div>
                        </div>

                        {/* Network Stats Bar */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                            {[
                                { label: 'Total Token Supply', value: formatNumber(stats.totalSupply), color: 'text-indigo-400' },
                                { label: 'Circulating Assets', value: formatNumber(stats.totalCirculating), color: 'text-violet-400' },
                                { label: 'Global Throughput', value: formatNumber(stats.totalThroughput), sub: 'tokens/sec', color: 'text-emerald-400' },
                                { label: 'Peak Capacity', value: '2.4M', sub: 'TPS', color: 'text-amber-400' }
                            ].map((stat, i) => (
                                <div key={i} className="glass p-5 flex flex-col justify-center animate-fade-in" style={{animationDelay: `${i * 0.1}s`}}>
                                    <p className="text-xs text-slate-500 font-bold uppercase mb-2">{stat.label}</p>
                                    <div className="flex items-baseline gap-2">
                                        <span className={`text-2xl font-bold ${stat.color}`}>{stat.value}</span>
                                        {stat.sub && <span className="text-xs text-slate-500 font-medium">{stat.sub}</span>}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Tokens Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {loading ? (
                                <div className="col-span-full py-20 text-center text-slate-500">
                                    <div className="animate-spin w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                                    Syncing token ledger...
                                </div>
                            ) : tokens.map((token, i) => (
                                <div key={token.feedId} className="token-card glass p-6 flex flex-col animate-fade-in" style={{animationDelay: `${i * 0.05}s`}}>
                                    <div className="flex justify-between items-start mb-6">
                                        <div>
                                            <div className="flex items-center gap-2 mb-1">
                                                <h3 className="text-xl font-bold text-indigo-400">{token.tokenSymbol}</h3>
                                                <span className="badge bg-indigo-500/10 text-indigo-400 text-[10px]">FIXED</span>
                                            </div>
                                            <p className="text-xs text-slate-500 font-medium">{token.feedName}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xs text-slate-500 uppercase font-bold tracking-tight mb-1">Price</p>
                                            <p className="text-lg font-bold">${token.tokenValue}</p>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 p-4 rounded-xl mb-6">
                                        <div className="flex justify-between text-xs mb-2">
                                            <span className="text-slate-400">Network Throughput</span>
                                            <span className="text-emerald-400 font-bold">{token.peakThroughput > 0 ? ((token.currentThroughput / token.peakThroughput) * 100).toFixed(1) : 0}%</span>
                                        </div>
                                        <div className="throughput-bar mb-3">
                                            <div className="throughput-fill" style={{width: `${token.peakThroughput > 0 ? (token.currentThroughput / token.peakThroughput) * 100 : 0}%`}}></div>
                                        </div>
                                        <div className="flex items-baseline gap-1 justify-center">
                                            <span className="text-xl font-bold">{formatNumber(token.currentThroughput)}</span>
                                            <span className="text-xs text-slate-500">TPT</span>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4 mb-8 text-sm">
                                        <div>
                                            <p className="text-xs text-slate-500 mb-1">Circulating</p>
                                            <p className="font-bold text-slate-200">{formatNumber(token.circulatingSupply)}</p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-slate-500 mb-1">Market Cap</p>
                                            <p className="font-bold text-slate-200">${formatNumber(token.circulatingSupply * token.tokenValue)}</p>
                                        </div>
                                    </div>

                                    <div className="mt-auto grid grid-cols-2 gap-3">
                                        <button className="btn btn-primary justify-center text-xs py-2 opacity-90 hover:opacity-100">
                                            Mint Volume
                                        </button>
                                        <button className="glass font-bold text-xs py-2 rounded-lg hover:bg-slate-800 transition-colors">
                                            Analytics
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    <footer className="mt-20 border-t border-slate-800 p-8 text-center text-slate-500">
                        <div className="flex items-center justify-center gap-4 mb-4 opacity-30">
                            <div className="w-8 h-8 rounded-lg bg-slate-700"></div>
                            <div className="w-8 h-8 rounded-lg bg-slate-700"></div>
                            <div className="w-8 h-8 rounded-lg bg-slate-700"></div>
                        </div>
                        <p className="text-sm">Aurigraph V11 Asset Tokenization Layer</p>
                        <p className="text-xs mt-2 opacity-50">EVM Compatible • High Throughput • Layer 1 Parallelism</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('tokens-root'));
        root.render(<FeedTokensDashboard />);
    </script>
</body>
</html>
