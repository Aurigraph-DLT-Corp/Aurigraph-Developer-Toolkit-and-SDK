input {
  tcp {
    port => 5000
    codec => json
  }

  udp {
    port => 5000
    codec => json
  }

  # Docker Beats input
  beats {
    port => 5044
  }
}

filter {
  if [source] {
    mutate {
      add_field => { "log_source" => "%{source}" }
    }
  }

  # Parse log levels
  if [message] =~ /ERROR|ERR/ {
    mutate {
      add_field => { "log_level" => "ERROR" }
    }
  } else if [message] =~ /WARN|WARN/ {
    mutate {
      add_field => { "log_level" => "WARNING" }
    }
  } else if [message] =~ /INFO|INFO/ {
    mutate {
      add_field => { "log_level" => "INFO" }
    }
  } else if [message] =~ /DEBUG|DEBUG/ {
    mutate {
      add_field => { "log_level" => "DEBUG" }
    }
  }

  # Add timestamp
  date {
    match => [ "timestamp", "ISO8601" ]
    target => "@timestamp"
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "aurigraph-logs-%{+YYYY.MM.dd}"
  }

  # Console output for debugging
  stdout {
    codec => rubydebug
  }
}
