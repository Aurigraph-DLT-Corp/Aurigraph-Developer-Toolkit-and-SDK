=== Aurigraph V11 Monitoring Stack - Access Information ===

Deployment Date: $(date)
Remote Host: REMOTE_HOST
Remote User: REMOTE_USER
Deploy Path: ~/monitoring

=== Service Endpoints ===

Prometheus (Metrics Database & UI):
  URL: http://REMOTE_HOST:9090
  Purpose: Collect and visualize metrics from all services
  Key Metrics:
    - v11_api_http_request_duration_ms
    - v11_transactions_total
    - v11_blockchain_height
    - postgresql_connections_total
    - node_cpu_seconds_total

Grafana (Visualization & Dashboards):
  URL: http://REMOTE_HOST:3000
  Default Credentials:
    Username: admin
    Password: admin (change after first login)
  Purpose: Create and manage monitoring dashboards

Alertmanager (Alert Management):
  URL: http://REMOTE_HOST:9093
  Purpose: Route and manage alerts from Prometheus
  Notification Channels:
    - Slack (#alerts-critical, #v11-alerts, etc.)
    - Email (alerts@dlt.aurigraph.io)
    - PagerDuty (on-call rotations)

=== Monitoring Exporters ===

1. Prometheus (Port 9090)
   - Collects metrics from V11 API endpoints
   - Metrics path: /api/v11/metrics
   - Scrape interval: 10s

2. Node Exporter (Port 9100)
   - System and host metrics (CPU, memory, disk, network)
   - Scrape interval: 15s

3. PostgreSQL Exporter (Port 9187)
   - Database metrics and performance stats
   - Connection count, query latency, index usage
   - Scrape interval: 30s

4. Redis Exporter (Port 9121)
   - Cache metrics and operations
   - Memory usage, eviction, replication status
   - Scrape interval: 30s

5. NGINX Exporter (Port 9113)
   - Reverse proxy metrics
   - Request rates, response times, error rates
   - Scrape interval: 15s

6. cAdvisor (Port 8080)
   - Container metrics
   - Memory, CPU, network usage per container
   - Scrape interval: 15s

7. Loki (Port 3100)
   - Log aggregation and analysis
   - Full-text search of application and system logs
   - Log retention: 30 days

8. Promtail
   - Log shipping agent
   - Collects from V11 app logs, syslog, PostgreSQL, Docker
   - Forwards to Loki for storage and analysis

=== Alert Rules Configured ===

Critical Alerts (P0):
  - V11 Service Down (immediate notification)
  - Database Connection Failure
  - High Error Rate (>10%)
  - Blockchain Height Not Increasing

Warning Alerts (P1):
  - High Response Latency (p95 > 500ms)
  - Database Query Latency > 100ms
  - Memory Pressure (>85% utilization)
  - Disk Space Low (<20% free)

Informational Alerts (P2):
  - High CPU Usage (>75%)
  - Network I/O Saturation (>80%)
  - Cache Hit Ratio Low (<60%)

=== Initial Setup Steps ===

1. Access Grafana: http://REMOTE_HOST:3000
2. Login with credentials above
3. Change admin password (Settings â†’ Change Password)
4. Add Prometheus as data source (if not auto-discovered)
5. Create custom dashboards for your metrics
6. Configure notification channels (Slack, Email, PagerDuty)
7. Test alerts by triggering sample alerts

=== Common Tasks ===

View real-time metrics:
  $ ssh REMOTE_USER@REMOTE_HOST
  $ cd ~/monitoring
  $ docker-compose -f docker-compose-monitoring.yml logs -f prometheus

Check service health:
  $ docker-compose -f docker-compose-monitoring.yml ps

Restart a service:
  $ docker-compose -f docker-compose-monitoring.yml restart prometheus

Stop monitoring stack:
  $ docker-compose -f docker-compose-monitoring.yml down

View Alertmanager alerts:
  $ curl http://REMOTE_HOST:9093/api/v1/alerts

Query metrics via Prometheus API:
  $ curl 'http://REMOTE_HOST:9090/api/v1/query?query=up'

=== Troubleshooting ===

If services don't start:
  1. Check Docker daemon: docker ps
  2. Check logs: docker-compose logs [service-name]
  3. Verify ports are not in use: lsof -i :9090
  4. Check disk space: df -h
  5. Restart stack: docker-compose down && docker-compose up -d

If metrics are missing:
  1. Verify V11 service is running: curl http://localhost:9003/api/v11/health
  2. Check Prometheus targets: http://REMOTE_HOST:9090/targets
  3. Verify scrape configs in prometheus.yml
  4. Check exporter connectivity: curl http://localhost:9100/metrics

If alerts are not firing:
  1. Verify alert rules in Prometheus: http://REMOTE_HOST:9090/alerts
  2. Check Alertmanager config: /home/REMOTE_USER/monitoring/alertmanager.yml
  3. Verify notification channels (test Slack webhook)
  4. Check Alertmanager logs: docker-compose logs alertmanager

=== Important Notes ===

- Monitoring stack requires Docker and ~500MB disk space
- Default retention is 30 days for metrics
- Database credentials needed for PostgreSQL exporter
- Slack/Email/PagerDuty config required for notifications
- Change all default credentials before production use
- Backup Grafana dashboards regularly

=== References ===

- Prometheus Docs: https://prometheus.io/docs/
- Grafana Docs: https://grafana.com/docs/grafana/latest/
- Alertmanager Docs: https://prometheus.io/docs/alerting/latest/alertmanager/
- Loki Docs: https://grafana.com/docs/loki/latest/

